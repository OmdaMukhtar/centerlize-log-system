# Global TLS Settings - These MUST come before the module load
global(
  DefaultNetstreamDriver="gtls"

  # This file MUST be the one used to sign the client CSRs
  DefaultNetstreamDriverCAFile="/etc/ssl/rsyslog/rsyslog.crt"
  DefaultNetstreamDriverCertFile="/etc/ssl/rsyslog/rsyslog.crt"
  DefaultNetstreamDriverKeyFile="/etc/ssl/rsyslog/rsyslog.key"
)

# Load TCP module with TLS support
module(load="imtcp" StreamDriver.Name="gtls" StreamDriver.Mode="1")

# Input definition
input(
  type="imtcp"
  port="6514"
  StreamDriver.AuthMode="x509/name"
  PermittedPeer=["*.example.com", "log.example.com"]
)

template(
  name="RemoteLogs"
  type="string"
  string="/var/log/remote/%HOSTNAME%/%PROGRAMNAME%.log"
)

action(
  type="omfile"
  dynaFile="RemoteLogs"
  DirCreateMode="0755"
  FileCreateMode="0644"
  CreateDirs="on"
)
